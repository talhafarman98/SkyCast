<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyCast - 3D Weather Forecast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #87CEEB, #1E90FF);
            min-height: 100vh;
            overflow-x: hidden;
            color: #1a365d;
        }
        
        .weather-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            transform: perspective(1000px);
        }
        
        .weather-card:hover {
            transform: perspective(1000px) rotateY(5deg) rotateX(5deg) scale(1.02);
            box-shadow: 0 15px 35px rgba(31, 38, 135, 0.3);
        }
        
        .sun-animation {
            animation: sunRotate 30s linear infinite;
        }
        
        .cloud-animation {
            animation: cloudFloat 20s ease-in-out infinite alternate;
        }
        
        .rain-animation {
            animation: rainFall 1s linear infinite;
        }
        
        .snow-animation {
            animation: snowFall 5s linear infinite;
        }
        
        .wind-animation {
            animation: windBlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes sunRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes cloudFloat {
            0% { transform: translateX(-10px); }
            100% { transform: translateX(10px); }
        }
        
        @keyframes rainFall {
            0% { transform: translateY(-10px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(10px); opacity: 0; }
        }
        
        @keyframes snowFall {
            0% { transform: translateY(-10px) rotate(0deg); }
            100% { transform: translateY(10px) rotate(360deg); }
        }
        
        @keyframes windBlow {
            0% { transform: translateX(-5px); }
            100% { transform: translateX(5px); }
        }
        
        .location-search {
            backdrop-filter: blur(5px);
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(31, 38, 135, 0.1);
        }
        
        .tab-active {
            background: rgba(255, 255, 255, 0.5);
            font-weight: 600;
            color: #1a365d;
        }
        
        .threejs-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.5;
        }
        
        .temperature-graph {
            height: 150px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
        }
        
        .hourly-item {
            transition: all 0.3s ease;
        }
        
        .hourly-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.4);
        }
        
        .day-card {
            transition: all 0.3s ease;
        }
        
        .day-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.4);
        }
        
        .location-dropdown {
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            color: #1a365d;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            margin-top: 5px;
        }
        
        .location-dropdown div {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .location-dropdown div:hover {
            background: rgba(30, 144, 255, 0.1);
        }
        
        .text-contrast {
            color: #1a365d;
        }
        
        .text-secondary {
            color: #2c5282;
        }
        
        .search-input {
            background: transparent;
            border: none;
            outline: none;
            color: #1a365d;
            font-weight: 500;
            width: 100%;
        }
        
        .search-input::placeholder {
            color: #4299e1;
            opacity: 0.8;
        }

        /* Chart container styling */
        .chart-container {
            position: relative;
            height: 150px;
            width: 100%;
        }
    </style>
</head>
<body class="text-contrast">
    <!-- Three.js Background -->
    <div id="threejs-container" class="threejs-container"></div>
    
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <i class="fas fa-cloud-sun text-3xl mr-3 text-blue-600"></i>
                <h1 class="text-2xl font-bold">SkyCast</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button class="px-4 py-2 rounded-full bg-white bg-opacity-30 hover:bg-opacity-40 transition">
                    <i class="fas fa-cog text-blue-600"></i>
                </button>
                <button class="px-4 py-2 rounded-full bg-white bg-opacity-30 hover:bg-opacity-40 transition">
                    <i class="fas fa-bell text-blue-600"></i>
                </button>
            </div>
        </header>
        
        <!-- Location Search -->
        <div class="mb-8 relative">
            <div class="location-search p-4 max-w-2xl mx-auto">
                <div class="flex items-center">
                    <i class="fas fa-map-marker-alt mr-3 text-blue-600"></i>
                    <input type="text" 
                           id="locationInput"
                           placeholder="Search for a city or address..." 
                           class="search-input flex-grow outline-none">
                    <button id="searchBtn" class="ml-2 p-2 rounded-full bg-blue-600 hover:bg-blue-700 transition text-white">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="mt-2 text-sm text-blue-600 flex justify-between px-2">
                    <span>Or use my <button id="currentLocationBtn" class="underline">current location</button></span>
                </div>
            </div>
            
            <!-- Location Suggestions Dropdown -->
            <div id="locationDropdown" class="location-dropdown absolute top-full left-0 right-0 max-w-2xl mx-auto hidden">
                <!-- Suggestions will be populated here -->
            </div>
        </div>
        
        <!-- Current Weather -->
        <div id="currentWeather" class="weather-card p-6 mb-8">
            <div class="flex justify-between items-start">
                <div>
                    <h2 id="locationName" class="text-2xl font-bold">Loading...</h2>
                    <div id="currentDate" class="text-secondary">-</div>
                    <div id="currentTemp" class="text-5xl font-bold mt-2">-°</div>
                    <div class="flex items-center mt-2">
                        <div id="weatherIcon" class="sun-animation text-yellow-500 text-2xl mr-2">
                            <i class="fas fa-question"></i>
                        </div>
                        <div id="weatherDescription">-</div>
                    </div>
                </div>
                <div class="text-right">
                    <div id="tempRange" class="text-xl">H: -° L: -°</div>
                    <div class="mt-2 text-sm text-secondary">
                        <div><i class="fas fa-wind mr-2"></i> Wind: <span id="windSpeed">-</span></div>
                        <div><i class="fas fa-tint mr-2"></i> Humidity: <span id="humidity">-</span></div>
                        <div><i class="fas fa-eye mr-2"></i> Visibility: <span id="visibility">-</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Forecast Tabs -->
        <div class="flex mb-6 bg-white bg-opacity-30 rounded-full p-1 max-w-md mx-auto">
            <button id="todayTab" class="flex-1 py-2 rounded-full tab-active">Today</button>
            <button id="dailyTab" class="flex-1 py-2 rounded-full">7 Days</button>
            <button id="hourlyTab" class="flex-1 py-2 rounded-full">14 Days</button>
        </div>
        
        <!-- Today Forecast (Default) -->
        <div id="todayForecast" class="mb-8">
            <h3 class="text-xl font-semibold mb-4">Hourly Forecast</h3>
            <div id="hourlyForecastContainer" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-8 gap-3">
                <!-- Hourly forecast will be populated here -->
                <div class="text-center">Loading...</div>
            </div>
            
            <!-- Temperature Graph -->
            <div class="weather-card p-4 mt-6">
                <h3 class="text-xl font-semibold mb-4">Temperature Trend</h3>
                <div class="chart-container">
                    <canvas id="temperatureChart"></canvas>
                </div>
            </div>
            
            <!-- Additional Weather Info -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <div class="weather-card p-4">
                    <h3 class="text-lg font-semibold mb-3">Air Quality</h3>
                    <div class="flex items-center">
                        <div id="airQuality" class="w-16 h-16 rounded-full bg-green-500 flex items-center justify-center text-2xl font-bold mr-4 text-white">
                            -
                        </div>
                        <div>
                            <div id="airQualityStatus" class="font-medium text-green-600">-</div>
                            <div id="airQualityDesc" class="text-sm text-secondary">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="weather-card p-4">
                    <h3 class="text-lg font-semibold mb-3">Sun & Moon</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="flex items-center mb-1">
                                <i class="fas fa-sun text-yellow-500 mr-2"></i>
                                <span>Sunrise</span>
                            </div>
                            <div id="sunrise" class="font-medium">-</div>
                        </div>
                        <div>
                            <div class="flex items-center mb-1">
                                <i class="fas fa-moon text-gray-500 mr-2"></i>
                                <span>Moonrise</span>
                            </div>
                            <div id="moonrise" class="font-medium">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 7-Day Forecast (Hidden by default) -->
        <div id="dailyForecast" class="mb-8 hidden">
            <h3 class="text-xl font-semibold mb-4">7-Day Forecast</h3>
            <div id="dailyForecastContainer" class="space-y-2">
                <!-- Daily forecast will be populated here -->
                <div class="text-center">Loading...</div>
            </div>
        </div>
        
        <!-- 14-Day Forecast (Hidden by default) -->
        <div id="extendedForecast" class="mb-8 hidden">
            <h3 class="text-xl font-semibold mb-4">14-Day Forecast</h3>
            <div id="extendedForecastContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Extended forecast will be populated here -->
                <div class="text-center">Loading...</div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="py-6 text-center text-secondary text-sm">
        <div class="container mx-auto px-4">
            <div class="mb-2">
                <a href="#" class="mx-2 hover:text-blue-800">Privacy Policy</a>
                <a href="#" class="mx-2 hover:text-blue-800">Terms of Service</a>
                <a href="#" class="mx-2 hover:text-blue-800">Contact Us</a>
            </div>
            <div>© 2023 SkyCast Weather. All rights reserved.</div>
            <div class="mt-2 text-xs opacity-75">
                <span class="inline-block transform rotate-3">✨</span>
                Crafted with care by 
                <span class="font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                    Muhammad Talha
                </span>
                <span class="inline-block transform -rotate-3">✨</span>
            </div>
        </div>
    </footer>

    <script>
        // API Configuration
        const API_KEY = "2273fd55983145234f64d05ed8f9a22e";
        let currentLocation = {
            lat: 40.7128,
            lon: -74.0060,
            name: "New York, NY"
        };
        
        // DOM Elements
        const locationInput = document.getElementById('locationInput');
        const searchBtn = document.getElementById('searchBtn');
        const currentLocationBtn = document.getElementById('currentLocationBtn');
        const locationDropdown = document.getElementById('locationDropdown');
        
        // Weather Display Elements
        const currentWeather = document.getElementById('currentWeather');
        const locationName = document.getElementById('locationName');
        const currentDate = document.getElementById('currentDate');
        const currentTemp = document.getElementById('currentTemp');
        const weatherIcon = document.getElementById('weatherIcon');
        const weatherDescription = document.getElementById('weatherDescription');
        const tempRange = document.getElementById('tempRange');
        const windSpeed = document.getElementById('windSpeed');
        const humidity = document.getElementById('humidity');
        const visibility = document.getElementById('visibility');
        const airQuality = document.getElementById('airQuality');
        const airQualityStatus = document.getElementById('airQualityStatus');
        const airQualityDesc = document.getElementById('airQualityDesc');
        const sunrise = document.getElementById('sunrise');
        const moonrise = document.getElementById('moonrise');
        
        // Forecast Containers
        const hourlyForecastContainer = document.getElementById('hourlyForecastContainer');
        const dailyForecastContainer = document.getElementById('dailyForecastContainer');
        const extendedForecastContainer = document.getElementById('extendedForecastContainer');
        
        // Tab Elements
        const todayTab = document.getElementById('todayTab');
        const dailyTab = document.getElementById('dailyTab');
        const hourlyTab = document.getElementById('hourlyTab');
        const todayForecast = document.getElementById('todayForecast');
        const dailyForecast = document.getElementById('dailyForecast');
        const extendedForecast = document.getElementById('extendedForecast');
        
        // Chart Element
        let temperatureChart = null;

        // Three.js Background Animation
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('threejs-container');
            
            // Set up Three.js scene
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            
            // Create particles
            const particlesGeometry = new THREE.BufferGeometry();
            const particleCount = 1000;
            
            const posArray = new Float32Array(particleCount * 3);
            for(let i = 0; i < particleCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 10;
            }
            
            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            
            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.02,
                color: 0xffffff,
                transparent: true,
                opacity: 0.8
            });
            
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);
            
            camera.position.z = 3;
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                particlesMesh.rotation.x += 0.0005;
                particlesMesh.rotation.y += 0.0005;
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', function() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // Tab switching functionality
            todayTab.addEventListener('click', function() {
                todayTab.classList.add('tab-active');
                dailyTab.classList.remove('tab-active');
                hourlyTab.classList.remove('tab-active');
                todayForecast.classList.remove('hidden');
                dailyForecast.classList.add('hidden');
                extendedForecast.classList.add('hidden');
            });
            
            dailyTab.addEventListener('click', function() {
                todayTab.classList.remove('tab-active');
                dailyTab.classList.add('tab-active');
                hourlyTab.classList.remove('tab-active');
                todayForecast.classList.add('hidden');
                dailyForecast.classList.remove('hidden');
                extendedForecast.classList.add('hidden');
                fetchDailyForecast();
            });
            
            hourlyTab.addEventListener('click', function() {
                todayTab.classList.remove('tab-active');
                dailyTab.classList.remove('tab-active');
                hourlyTab.classList.add('tab-active');
                todayForecast.classList.add('hidden');
                dailyForecast.classList.add('hidden');
                extendedForecast.classList.remove('hidden');
                fetchExtendedForecast();
            });
            
            // Location search functionality
            searchBtn.addEventListener('click', searchLocation);
            locationInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchLocation();
                }
            });
            
            // Current location button
            currentLocationBtn.addEventListener('click', getCurrentLocation);
            
            // Initialize with default location
            updateWeatherData();
        });
        
        // Search for location
        async function searchLocation() {
            const query = locationInput.value.trim();
            if (!query) return;
            
            try {
                const response = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${query}&limit=5&appid=${API_KEY}`);
                const data = await response.json();
                
                if (data.length === 0) {
                    locationDropdown.innerHTML = '<div class="px-4 py-2 text-center">No locations found</div>';
                    locationDropdown.classList.remove('hidden');
                    return;
                }
                
                locationDropdown.innerHTML = '';
                data.forEach(location => {
                    const locationElement = document.createElement('div');
                    locationElement.className = 'px-4 py-2 hover:bg-blue-50 cursor-pointer flex items-center';
                    locationElement.innerHTML = `
                        <i class="fas fa-map-marker-alt mr-3 text-blue-600"></i>
                        <div>
                            <div class="font-medium">${location.name}, ${location.country}</div>
                            <div class="text-xs text-secondary">${location.lat.toFixed(4)}° ${location.lat > 0 ? 'N' : 'S'}, ${Math.abs(location.lon).toFixed(4)}° ${location.lon > 0 ? 'E' : 'W'}</div>
                        </div>
                    `;
                    locationElement.addEventListener('click', () => {
                        currentLocation = {
                            lat: location.lat,
                            lon: location.lon,
                            name: `${location.name}, ${location.state || location.country}`
                        };
                        locationInput.value = currentLocation.name;
                        locationDropdown.classList.add('hidden');
                        updateWeatherData();
                    });
                    locationDropdown.appendChild(locationElement);
                });
                
                locationDropdown.classList.remove('hidden');
            } catch (error) {
                console.error('Error searching locations:', error);
                locationDropdown.innerHTML = '<div class="px-4 py-2 text-center">Error fetching locations</div>';
                locationDropdown.classList.remove('hidden');
            }
        }
        
        // Get current location
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude,
                            name: "Your Location"
                        };
                        updateWeatherData();
                        reverseGeocode(position.coords.latitude, position.coords.longitude);
                    },
                    error => {
                        console.error('Error getting location:', error);
                        alert('Could not get your current location. Using default location instead.');
                        updateWeatherData();
                    }
                );
            } else {
                alert('Geolocation is not supported by your browser. Using default location instead.');
                updateWeatherData();
            }
        }
        
        // Reverse geocode to get location name
        async function reverseGeocode(lat, lon) {
            try {
                const response = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${API_KEY}`);
                const data = await response.json();
                
                if (data.length > 0) {
                    currentLocation.name = `${data[0].name}, ${data[0].country}`;
                    locationInput.value = currentLocation.name;
                    updateWeatherData();
                }
            } catch (error) {
                console.error('Error reverse geocoding:', error);
            }
        }
        
        // Update all weather data
        async function updateWeatherData() {
            locationName.textContent = currentLocation.name;
            updateCurrentDate();
            
            try {
                // Fetch current weather
                const currentWeatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${currentLocation.lat}&lon=${currentLocation.lon}&appid=${API_KEY}&units=imperial`);
                const currentWeatherData = await currentWeatherResponse.json();
                
                // Update current weather display
                currentTemp.textContent = `${Math.round(currentWeatherData.main.temp)}°F`;
                weatherDescription.textContent = currentWeatherData.weather[0].description;
                tempRange.textContent = `H: ${Math.round(currentWeatherData.main.temp_max)}° L: ${Math.round(currentWeatherData.main.temp_min)}°`;
                windSpeed.textContent = `${Math.round(currentWeatherData.wind.speed)} mph ${getWindDirection(currentWeatherData.wind.deg)}`;
                humidity.textContent = `${currentWeatherData.main.humidity}%`;
                visibility.textContent = `${(currentWeatherData.visibility / 1609.34).toFixed(1)} mi`;
                
                // Update weather icon
                updateWeatherIcon(weatherIcon, currentWeatherData.weather[0].id, currentWeatherData.weather[0].icon);
                
                // Fetch 5-day forecast for hourly data
                const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${currentLocation.lat}&lon=${currentLocation.lon}&appid=${API_KEY}&units=imperial`);
                const forecastData = await forecastResponse.json();
                
                // Update hourly forecast
                updateHourlyForecast(forecastData.list);
                
                // Update temperature chart
                updateTemperatureChart(forecastData.list);
                
                // Fetch air quality (mock data since API key might not have access)
                const randomAQI = Math.floor(Math.random() * 150) + 20;
                airQuality.textContent = randomAQI;
                if (randomAQI <= 50) {
                    airQualityStatus.textContent = "Good";
                    airQualityDesc.textContent = "Air quality is satisfactory";
                    airQuality.className = "w-16 h-16 rounded-full bg-green-500 flex items-center justify-center text-2xl font-bold mr-4 text-white";
                } else if (randomAQI <= 100) {
                    airQualityStatus.textContent = "Moderate";
                    airQualityDesc.textContent = "Air quality is acceptable";
                    airQuality.className = "w-16 h-16 rounded-full bg-yellow-500 flex items-center justify-center text-2xl font-bold mr-4 text-white";
                } else {
                    airQualityStatus.textContent = "Unhealthy";
                    airQualityDesc.textContent = "Sensitive groups should limit outdoor activity";
                    airQuality.className = "w-16 h-16 rounded-full bg-red-500 flex items-center justify-center text-2xl font-bold mr-4 text-white";
                }
                
                // Update sunrise/sunset (mock moonrise)
                const sunriseTime = new Date(currentWeatherData.sys.sunrise * 1000);
                sunrise.textContent = sunriseTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Mock moonrise (not available in free API)
                const moonriseTime = new Date();
                moonriseTime.setHours(20, 15);
                moonrise.textContent = moonriseTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            } catch (error) {
                console.error('Error fetching weather data:', error);
                currentTemp.textContent = "Error";
                weatherDescription.textContent = "Could not load weather data";
            }
        }
        
        // Update hourly forecast
        function updateHourlyForecast(hourlyData) {
            hourlyForecastContainer.innerHTML = '';
            
            // Show next 8 hours
            for (let i = 0; i < 8; i++) {
                const forecast = hourlyData[i];
                const time = new Date(forecast.dt * 1000);
                const hour = time.getHours();
                const displayTime = i === 0 ? "Now" : hour > 12 ? `${hour - 12} PM` : hour === 12 ? "12 PM" : `${hour} AM`;
                
                const hourElement = document.createElement('div');
                hourElement.className = 'hourly-item bg-white bg-opacity-20 rounded-xl p-3 text-center';
                hourElement.innerHTML = `
                    <div>${displayTime}</div>
                    <div class="my-2 text-2xl">
                        ${getWeatherIconHTML(forecast.weather[0].id, forecast.weather[0].icon)}
                    </div>
                    <div class="font-medium">${Math.round(forecast.main.temp)}°</div>
                `;
                hourlyForecastContainer.appendChild(hourElement);
            }
        }
        
        // Update temperature chart
        function updateTemperatureChart(hourlyData) {
            const ctx = document.getElementById('temperatureChart').getContext('2d');
            
            // Prepare data for chart
            const labels = [];
            const temps = [];
            
            // Get next 12 hours (3-hour intervals)
            for (let i = 0; i < 5; i++) {
                const forecast = hourlyData[i];
                const time = new Date(forecast.dt * 1000);
                const hour = time.getHours();
                labels.push(i === 0 ? "Now" : hour > 12 ? `${hour - 12} PM` : hour === 12 ? "12 PM" : `${hour} AM`);
                temps.push(Math.round(forecast.main.temp));
            }
            
            // Destroy previous chart if exists
            if (temperatureChart) {
                temperatureChart.destroy();
            }
            
            // Create new chart
            temperatureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Temperature (°F)',
                        data: temps,
                        borderColor: '#4299e1',
                        backgroundColor: 'rgba(66, 153, 225, 0.2)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#3182ce',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 54, 93, 0.9)',
                            titleFont: {
                                family: 'Poppins',
                                size: 14
                            },
                            bodyFont: {
                                family: 'Poppins',
                                size: 12
                            },
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw}°F`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#2c5282',
                                font: {
                                    family: 'Poppins',
                                    size: 10
                                }
                            }
                        },
                        y: {
                            display: false,
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        // Fetch daily forecast (7 days)
        async function fetchDailyForecast() {
            try {
                // Using the 5-day forecast API (3-hour intervals) since the daily API requires a paid plan
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${currentLocation.lat}&lon=${currentLocation.lon}&appid=${API_KEY}&units=imperial`);
                const data = await response.json();
                
                dailyForecastContainer.innerHTML = '';
                
                // Group forecasts by day
                const dailyForecasts = {};
                data.list.forEach(forecast => {
                    const date = new Date(forecast.dt * 1000);
                    const dateString = date.toLocaleDateString();
                    
                    if (!dailyForecasts[dateString]) {
                        dailyForecasts[dateString] = {
                            date: date,
                            forecasts: [],
                            temp_min: forecast.main.temp_min,
                            temp_max: forecast.main.temp_max
                        };
                    }
                    
                    dailyForecasts[dateString].forecasts.push(forecast);
                    if (forecast.main.temp_min < dailyForecasts[dateString].temp_min) {
                        dailyForecasts[dateString].temp_min = forecast.main.temp_min;
                    }
                    if (forecast.main.temp_max > dailyForecasts[dateString].temp_max) {
                        dailyForecasts[dateString].temp_max = forecast.main.temp_max;
                    }
                });
                
                // Display one forecast per day (using the first forecast of the day)
                let dayCount = 0;
                for (const dateString in dailyForecasts) {
                    if (dayCount >= 7) break;
                    
                    const dayData = dailyForecasts[dateString];
                    const firstForecast = dayData.forecasts[0];
                    const dayName = dayCount === 0 ? "Today" : dayData.date.toLocaleDateString([], { weekday: 'short' });
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'day-card weather-card p-3 flex justify-between items-center';
                    dayElement.innerHTML = `
                        <div class="w-24">${dayName}</div>
                        <div class="flex-grow flex items-center">
                            <div class="w-10 text-center">
                                ${getWeatherIconHTML(firstForecast.weather[0].id, firstForecast.weather[0].icon)}
                            </div>
                            <div class="text-sm text-secondary ml-2">${firstForecast.weather[0].description}</div>
                        </div>
                        <div class="flex items-center">
                            <span class="font-medium mr-3">${Math.round(dayData.temp_max)}°</span>
                            <span class="text-secondary">${Math.round(dayData.temp_min)}°</span>
                        </div>
                    `;
                    dailyForecastContainer.appendChild(dayElement);
                    dayCount++;
                }
            } catch (error) {
                console.error('Error fetching daily forecast:', error);
                dailyForecastContainer.innerHTML = '<div class="text-center py-4">Could not load daily forecast</div>';
            }
        }
        
        // Fetch extended forecast (14 days)
        async function fetchExtendedForecast() {
            try {
                // Using the 5-day forecast API (3-hour intervals) since the 16-day API requires a paid plan
                // For demo purposes, we'll simulate 14 days by repeating the 5-day forecast
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${currentLocation.lat}&lon=${currentLocation.lon}&appid=${API_KEY}&units=imperial`);
                const data = await response.json();
                
                extendedForecastContainer.innerHTML = '';
                
                // Group forecasts by day
                const dailyForecasts = {};
                data.list.forEach(forecast => {
                    const date = new Date(forecast.dt * 1000);
                    const dateString = date.toLocaleDateString();
                    
                    if (!dailyForecasts[dateString]) {
                        dailyForecasts[dateString] = {
                            date: date,
                            forecasts: [],
                            temp_min: forecast.main.temp_min,
                            temp_max: forecast.main.temp_max
                        };
                    }
                    
                    dailyForecasts[dateString].forecasts.push(forecast);
                    if (forecast.main.temp_min < dailyForecasts[dateString].temp_min) {
                        dailyForecasts[dateString].temp_min = forecast.main.temp_min;
                    }
                    if (forecast.main.temp_max > dailyForecasts[dateString].temp_max) {
                        dailyForecasts[dateString].temp_max = forecast.main.temp_max;
                    }
                });
                
                // Display one forecast per day (using the first forecast of the day)
                // For demo, we'll simulate 14 days by repeating the available days
                let dayCount = 0;
                const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                const dayValues = Object.values(dailyForecasts);
                
                while (dayCount < 14) {
                    const dayIndex = dayCount % dayValues.length;
                    const dayData = dayValues[dayIndex];
                    const firstForecast = dayData.forecasts[0];
                    
                    // Create a simulated date for the extended forecast
                    const simulatedDate = new Date();
                    simulatedDate.setDate(simulatedDate.getDate() + dayCount);
                    const dayName = dayCount === 0 ? "Today" : simulatedDate.toLocaleDateString([], { weekday: 'short' });
                    
                    // Randomly adjust temperature for simulation
                    const tempAdjustment = Math.floor(Math.random() * 5) - 2;
                    const temp_max = Math.round(dayData.temp_max + tempAdjustment);
                    const temp_min = Math.round(dayData.temp_min + tempAdjustment);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'day-card weather-card p-4';
                    dayElement.innerHTML = `
                        <div class="font-medium mb-2">${dayName}</div>
                        <div class="flex items-center justify-center mb-3 text-4xl">
                            ${getWeatherIconHTML(firstForecast.weather[0].id, firstForecast.weather[0].icon)}
                        </div>
                        <div class="text-center text-sm text-secondary mb-1">${firstForecast.weather[0].description}</div>
                        <div class="flex justify-between mt-2">
                            <div class="text-sm">${temp_min}°</div>
                            <div class="font-medium">${temp_max}°</div>
                        </div>
                    `;
                    extendedForecastContainer.appendChild(dayElement);
                    dayCount++;
                }
            } catch (error) {
                console.error('Error fetching extended forecast:', error);
                extendedForecastContainer.innerHTML = '<div class="text-center py-4">Could not load extended forecast</div>';
            }
        }
        
        // Helper function to update weather icon
        function updateWeatherIcon(element, weatherId, iconCode) {
            let iconClass = '';
            let animationClass = '';
            
            // Clear previous classes
            element.className = 'text-2xl mr-2';
            
            // Determine icon based on weather ID
            if (weatherId >= 200 && weatherId < 300) {
                // Thunderstorm
                iconClass = 'fas fa-bolt text-yellow-400';
            } else if (weatherId >= 300 && weatherId < 400) {
                // Drizzle
                iconClass = 'fas fa-cloud-rain text-blue-300';
                animationClass = 'rain-animation';
            } else if (weatherId >= 500 && weatherId < 600) {
                // Rain
                iconClass = 'fas fa-cloud-showers-heavy text-blue-400';
                animationClass = 'rain-animation';
            } else if (weatherId >= 600 && weatherId < 700) {
                // Snow
                iconClass = 'fas fa-snowflake text-blue-100';
                animationClass = 'snow-animation';
            } else if (weatherId >= 700 && weatherId < 800) {
                // Atmosphere (fog, mist, etc.)
                iconClass = 'fas fa-smog text-gray-300';
            } else if (weatherId === 800) {
                // Clear
                if (iconCode.includes('d')) {
                    iconClass = 'fas fa-sun text-yellow-400';
                    animationClass = 'sun-animation';
                } else {
                    iconClass = 'fas fa-moon text-gray-300';
                }
            } else if (weatherId > 800) {
                // Clouds
                if (weatherId === 801 || weatherId === 802) {
                    iconClass = 'fas fa-cloud-sun text-yellow-300';
                    animationClass = 'cloud-animation';
                } else {
                    iconClass = 'fas fa-cloud text-gray-300';
                    animationClass = 'cloud-animation';
                }
            }
            
            element.innerHTML = `<i class="${iconClass} ${animationClass}"></i>`;
        }
        
        // Helper function to get weather icon HTML
        function getWeatherIconHTML(weatherId, iconCode) {
            let iconClass = '';
            let animationClass = '';
            
            if (weatherId >= 200 && weatherId < 300) {
                iconClass = 'fas fa-bolt text-yellow-400';
            } else if (weatherId >= 300 && weatherId < 400) {
                iconClass = 'fas fa-cloud-rain text-blue-300';
                animationClass = 'rain-animation';
            } else if (weatherId >= 500 && weatherId < 600) {
                iconClass = 'fas fa-cloud-showers-heavy text-blue-400';
                animationClass = 'rain-animation';
            } else if (weatherId >= 600 && weatherId < 700) {
                iconClass = 'fas fa-snowflake text-blue-100';
                animationClass = 'snow-animation';
            } else if (weatherId >= 700 && weatherId < 800) {
                iconClass = 'fas fa-smog text-gray-300';
            } else if (weatherId === 800) {
                if (iconCode.includes('d')) {
                    iconClass = 'fas fa-sun text-yellow-400';
                    animationClass = 'sun-animation';
                } else {
                    iconClass = 'fas fa-moon text-gray-300';
                }
            } else if (weatherId > 800) {
                if (weatherId === 801 || weatherId === 802) {
                    iconClass = 'fas fa-cloud-sun text-yellow-300';
                    animationClass = 'cloud-animation';
                } else {
                    iconClass = 'fas fa-cloud text-gray-300';
                    animationClass = 'cloud-animation';
                }
            }
            
            return `<i class="${iconClass} ${animationClass}"></i>`;
        }
        
        // Helper function to get wind direction
        function getWindDirection(degrees) {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round((degrees % 360) / 45) % 8;
            return directions[index];
        }
        
        // Helper function to update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            currentDate.textContent = now.toLocaleDateString(undefined, options);
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!locationInput.contains(e.target) && !locationDropdown.contains(e.target)) {
                locationDropdown.classList.add('hidden');
            }
        });
    </script>
</body>
</html>